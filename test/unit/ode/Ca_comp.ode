variables("Ca_comp", 
       VFonRT=ScalarParam(-1.31045962116),
       F=ScalarParam(96.5),
       E_Ca=ScalarParam(134.479067982),
       K_o=ScalarParam(4.0),
       V=ScalarParam(-35),
       V_JSR=ScalarParam(1.6e-07),
       A_cap=ScalarParam(0.0001534),
       V_NSR=ScalarParam(2.1e-06),
       expVFonRT=ScalarParam(0.269696069873),
       C_sc=ScalarParam(1.0),
       K_i=ScalarParam(159.48),
       Ca_o=ScalarParam(2.0),
       V_ss=ScalarParam(1.2e-09),
       V_myo=ScalarParam(2.584e-05),
       I_NaCa=ScalarParam(0.0680605650624),)

states("Intracellular Ca", 
       Ca_JSR=ScalarParam(0.2616),
       Ca_NSR=ScalarParam(0.262),
       Ca_i=ScalarParam(8.464e-05),
       Ca_ss=ScalarParam(0.0001315),
       HTRPNCa=ScalarParam(0.13664),
       LTRPNCa=ScalarParam(0.0055443),)

parameters("Intracellular Ca", 
       CMDNtot=ScalarParam(0.05),
       CSQNtot=ScalarParam(15.0),
       EGTAtot=ScalarParam(10.0),
       HTRPNtot=ScalarParam(0.14),
       KmCMDN=ScalarParam(0.00238),
       KmCSQN=ScalarParam(0.8),
       KmEGTA=ScalarParam(0.00015),
       LTRPNtot=ScalarParam(0.07),
       khtrpn_minus=ScalarParam(6.6e-05),
       khtrpn_plus=ScalarParam(20.0),
       kltrpn_minus=ScalarParam(0.04),
       kltrpn_plus=ScalarParam(40.0),
       tau_tr=ScalarParam(0.5747),
       tau_xfer=ScalarParam(26.7),)

states("RyR Channel", 
       C1_RyR=ScalarParam(0.4929),
       C2_RyR=ScalarParam(0.5065),
       O1_RyR=ScalarParam(0.0006027),
       O2_RyR=ScalarParam(2.882e-09),)

parameters("RyR Channel", 
       kaminus=ScalarParam(0.576),
       kaplus=ScalarParam(0.01215),
       kbminus=ScalarParam(1.93),
       kbplus=ScalarParam(0.00405),
       kcminus=ScalarParam(0.0008),
       kcplus=ScalarParam(0.1),
       mcoop=ScalarParam(3.0),
       ncoop=ScalarParam(4.0),
       v_1=ScalarParam(1.8),)

states("L-type Ca Channel", 
       C0=ScalarParam(0.99802),
       C1=ScalarParam(1.9544e-06),
       C2=ScalarParam(0),
       C3=ScalarParam(0),
       C4=ScalarParam(0),
       CCa0=ScalarParam(0.0019734),
       CCa1=ScalarParam(0),
       CCa2=ScalarParam(0),
       CCa3=ScalarParam(0),
       CCa4=ScalarParam(0),
       Open=ScalarParam(0),
       yCa=ScalarParam(0.7959),)

parameters("L-type Ca Channel", 
       ICahalf=ScalarParam(-0.265),
       PCa=ScalarParam(0.0003125),
       PK=ScalarParam(5.79e-07),
       aL=ScalarParam(2.0),
       bL=ScalarParam(2.0),
       fL=ScalarParam(0.3),
       gL=ScalarParam(2.0),
       omega=ScalarParam(0.01),)

parameters("Sarcolemmal Ca pump current I_pCa", 
       I_pCaMax=ScalarParam(0.05),
       K_mpCa=ScalarParam(5e-05),)

parameters("Ca background current I_bCa", 
       G_bCaMax=ScalarParam(0.0003842),)

parameters("SERCA2a Pump", 
       K_SR=ScalarParam(1.0),
       K_fb=ScalarParam(0.000168),
       K_rb=ScalarParam(3.29),
       N_fb=ScalarParam(1.2),
       N_rb=ScalarParam(1.0),
       v_maxf=ScalarParam(8.13e-05),
       v_maxr=ScalarParam(0.000318),)


component("Sarcolemmal Ca pump current I_pCa")
I_pCa = Ca_i*I_pCaMax/(Ca_i + K_mpCa)

component("Ca background current I_bCa")
I_bCa = G_bCaMax*(-E_Ca + V)

component("L-type Ca Channel")
alpha = 0.488561103264068*exp(0.1*V)
beta = 0.0428701959580221*exp(-0.0769230769230769*V)
alpha_prime = aL*alpha
beta_prime = beta/bL
gamma = 0.10375*Ca_ss
C0_to_C1 = 4.0*alpha
C1_to_C2 = 3.0*alpha
C2_to_C3 = 2.0*alpha
C3_to_C4 = alpha
CCa0_to_CCa1 = 4.0*alpha_prime
CCa1_to_CCa2 = 3.0*alpha_prime
CCa2_to_CCa3 = 2.0*alpha_prime
CCa3_to_CCa4 = alpha_prime
C1_to_C0 = beta
C2_to_C1 = 2.0*beta
C3_to_C2 = 3.0*beta
C4_to_C3 = 4.0*beta
CCa1_to_CCa0 = beta_prime
CCa2_to_CCa1 = 2.0*beta_prime
CCa3_to_CCa2 = 3.0*beta_prime
CCa4_to_CCa3 = 4.0*beta_prime
gamma = 0.10375*Ca_ss
C0_to_CCa0 = gamma
C1_to_CCa1 = C0_to_CCa0*aL
C2_to_CCa2 = C1_to_CCa1*aL
C3_to_CCa3 = C2_to_CCa2*aL
C4_to_CCa4 = C3_to_CCa3*aL
CCa0_to_C0 = omega
CCa1_to_C1 = CCa0_to_C0/bL
CCa2_to_C2 = CCa1_to_C1/bL
CCa3_to_C3 = CCa2_to_C2/bL
CCa4_to_C4 = CCa3_to_C3/bL
a1 = C0*(C0_to_C1 + C0_to_CCa0)
a2 = C1*C1_to_C0 + CCa0*CCa0_to_C0
dC0 = -a1 + a2
a1 = C1*(C1_to_C0 + C1_to_C2 + C1_to_CCa1)
a2 = C0*C0_to_C1 + C2*C2_to_C1 + CCa1*CCa1_to_C1
dC1 = -a1 + a2
a1 = C2*(C2_to_C1 + C2_to_C3 + C2_to_CCa2)
a2 = C1*C1_to_C2 + C3*C3_to_C2 + CCa2*CCa2_to_C2
dC2 = -a1 + a2
a1 = C3*(C3_to_C2 + C3_to_C4 + C3_to_CCa3)
a2 = C2*C2_to_C3 + C4*C4_to_C3 + CCa3*CCa3_to_C3
dC3 = -a1 + a2
a1 = C4*(C4_to_C3 + C4_to_CCa4 + fL)
a2 = C3*C3_to_C4 + CCa4*CCa4_to_C4 + Open*gL
dC4 = -a1 + a2
dOpen = C4*fL - Open*gL
a1 = CCa0*(CCa0_to_C0 + CCa0_to_CCa1)
a2 = C0*C0_to_CCa0 + CCa1*CCa1_to_CCa0
dCCa0 = -a1 + a2
a1 = CCa1*(CCa1_to_C1 + CCa1_to_CCa0 + CCa1_to_CCa2)
a2 = C1*C1_to_CCa1 + CCa0*CCa0_to_CCa1 + CCa2*CCa2_to_CCa1
dCCa1 = -a1 + a2
a1 = CCa2*(CCa2_to_C2 + CCa2_to_CCa1 + CCa2_to_CCa3)
a2 = C2*C2_to_CCa2 + CCa1*CCa1_to_CCa2 + CCa3*CCa3_to_CCa2
dCCa2 = -a1 + a2
a1 = CCa3*(CCa3_to_C3 + CCa3_to_CCa2 + CCa3_to_CCa4)
a2 = C3*C3_to_CCa3 + CCa2*CCa2_to_CCa3 + CCa4*CCa4_to_CCa3
dCCa3 = -a1 + a2
a1 = CCa4*(CCa4_to_C4 + CCa4_to_CCa3)
a2 = C4*C4_to_CCa4 + CCa3*CCa3_to_CCa4
dCCa4 = -a1 + a2
yCa_inf = 0.2 + 0.8/(12.1824939607035*exp(0.2*V) + 1.0)
tau_yCa = 20.0 + 600.0/(8.2092630577501*exp(0.105263157894737*V) + 1.0)
dyCa = (-yCa + yCa_inf)/tau_yCa
VFsqonRT = 1000.0*F*VFonRT
a1 = -0.341*Ca_o + 0.001*exp(2.0*VFonRT)
a2 = exp(2.0*VFonRT) - 1.0
ICamax = 4.0*PCa*VFsqonRT*a1/a2
I_Ca = ICamax*Open*yCa
PKprime = PK/(1.0 + Min(0.0, ICamax)/ICahalf)
a1 = K_i*expVFonRT - K_o
a2 = expVFonRT - 1.0
I_CaK = Open*PKprime*VFsqonRT*a1*yCa/a2

component("RyR Channel")
a1 = (1000.0*Ca_ss)**mcoop
a2 = (1000.0*Ca_ss)**ncoop
dC1_RyR = -C1_RyR*a2*kaplus + O1_RyR*kaminus
dO2_RyR = O1_RyR*a1*kbplus - O2_RyR*kbminus
dC2_RyR = -C2_RyR*kcminus + O1_RyR*kcplus
dO1_RyR = -dC1_RyR - dC2_RyR - dO2_RyR
J_rel = v_1*(Ca_JSR - Ca_ss)*(O1_RyR + O2_RyR)

component("SERCA2a Pump")
f_b = (Ca_i/K_fb)**N_fb
r_b = (Ca_NSR/K_rb)**N_rb
J_up = K_SR*(f_b*v_maxf - r_b*v_maxr)/(f_b + r_b + 1.0)

component("Intracellular Ca")
J_tr = (-Ca_JSR + Ca_NSR)/tau_tr
J_xfer = (-Ca_i + Ca_ss)/tau_xfer
a1 = LTRPNCa*kltrpn_minus
dLTRPNCa = Ca_i*kltrpn_plus*(-LTRPNCa + 1.0) - a1
a1 = HTRPNCa*khtrpn_minus
dHTRPNCa = Ca_i*khtrpn_plus*(-HTRPNCa + 1.0) - a1
J_trpn = HTRPNtot*dHTRPNCa + LTRPNtot*dLTRPNCa
a1 = CMDNtot*KmCMDN*(Ca_ss + KmCMDN)**(-2.0)
beta_ss = 1.0/(a1 + 1.0)
a1 = CSQNtot*KmCSQN*(Ca_JSR + KmCSQN)**(-2.0)
beta_JSR = 1.0/(a1 + 1.0)
a1 = CMDNtot*KmCMDN*(Ca_i + KmCMDN)**(-2.0)
beta_i = 1.0/(a1 + 1.0)
comment("The ODE system")

dCa_i_dt = beta_i*(-A_cap*C_sc*(-2.0*I_NaCa + I_bCa + I_pCa)/(2000.0*F*V_myo) - J_trpn - J_up + J_xfer)
dCa_NSR_dt = -J_tr*V_JSR/V_NSR + J_up*V_myo/V_NSR
dCa_ss_dt = beta_ss*(-A_cap*C_sc*I_Ca/(2000.0*F*V_ss) + J_rel*V_JSR/V_ss - J_xfer*V_myo/V_ss)
dCa_JSR_dt = beta_JSR*(-J_rel + J_tr)
dLTRPNCa_dt = dLTRPNCa
dHTRPNCa_dt = dHTRPNCa
dC1_RyR_dt = dC1_RyR
dO1_RyR_dt = dO1_RyR
dO2_RyR_dt = dO2_RyR
dC2_RyR_dt = dC2_RyR
dC0_dt = dC0
dC1_dt = dC1
dC2_dt = dC2
dC3_dt = dC3
dC4_dt = dC4
dOpen_dt = dOpen
dCCa0_dt = dCCa0
dCCa1_dt = dCCa1
dCCa2_dt = dCCa2
dCCa3_dt = dCCa3
dCCa4_dt = dCCa4
dyCa_dt = dyCa