variables("Ca_comp", 
       A_cap=ScalarParam(0.0001534),
       K_i=ScalarParam(159.48),
       E_Ca=ScalarParam(134.479067982),
       C_sc=ScalarParam(1.0),
       V_myo=ScalarParam(2.584e-05),
       K_o=ScalarParam(4.0),
       F=ScalarParam(96.5),
       V_ss=ScalarParam(1.2e-09),
       V_JSR=ScalarParam(1.6e-07),
       expVFonRT=ScalarParam(0.269696069873),
       V=ScalarParam(-35),
       VFonRT=ScalarParam(-1.31045962116),
       Ca_o=ScalarParam(2.0),
       I_NaCa=ScalarParam(0.0680605650624),
       V_NSR=ScalarParam(2.1e-06),)

markov_model("lcc", "L-type Ca Channel", algebraic_sum=1.0,
             C0=ScalarParam(0.99802),
             C1=ScalarParam(4.6456e-06),
             C2=ScalarParam(1.9544e-06),
             C3=ScalarParam(0),
             C4=ScalarParam(0),
             CCa0=ScalarParam(0.0019734),
             CCa1=ScalarParam(0),
             CCa2=ScalarParam(0),
             CCa3=ScalarParam(0),
             CCa4=ScalarParam(0),
             Open=ScalarParam(0),)

states("L-type Ca Channel", 
       yCa=ScalarParam(0.7959),)

parameters("L-type Ca Channel", 
       ICahalf=ScalarParam(-0.265),
       PCa=ScalarParam(0.0003125),
       PK=ScalarParam(5.79e-07),
       aL=ScalarParam(2.0),
       bL=ScalarParam(2.0),
       fL=ScalarParam(0.3),
       gL=ScalarParam(2.0),
       omega=ScalarParam(0.01),)

states("Intracellular Ca", 
       Ca_JSR=ScalarParam(0.2616),
       Ca_NSR=ScalarParam(0.262),
       Ca_i=ScalarParam(8.464e-05),
       Ca_ss=ScalarParam(0.0001315),
       HTRPNCa=ScalarParam(0.13664),
       LTRPNCa=ScalarParam(0.0055443),)

parameters("Intracellular Ca", 
       CMDNtot=ScalarParam(0.05),
       CSQNtot=ScalarParam(15.0),
       EGTAtot=ScalarParam(10.0),
       HTRPNtot=ScalarParam(0.14),
       KmCMDN=ScalarParam(0.00238),
       KmCSQN=ScalarParam(0.8),
       KmEGTA=ScalarParam(0.00015),
       LTRPNtot=ScalarParam(0.07),
       khtrpn_minus=ScalarParam(6.6e-05),
       khtrpn_plus=ScalarParam(20.0),
       kltrpn_minus=ScalarParam(0.04),
       kltrpn_plus=ScalarParam(40.0),
       tau_tr=ScalarParam(0.5747),
       tau_xfer=ScalarParam(26.7),)

states("RyR Channel", 
       C1_RyR=ScalarParam(0.4929),
       C2_RyR=ScalarParam(0.5065),
       O1_RyR=ScalarParam(0.0006027),
       O2_RyR=ScalarParam(2.882e-09),)

parameters("RyR Channel", 
       kaminus=ScalarParam(0.576),
       kaplus=ScalarParam(0.01215),
       kbminus=ScalarParam(1.93),
       kbplus=ScalarParam(0.00405),
       kcminus=ScalarParam(0.0008),
       kcplus=ScalarParam(0.1),
       mcoop=ScalarParam(3.0),
       ncoop=ScalarParam(4.0),
       v_1=ScalarParam(1.8),)

parameters("Sarcolemmal Ca pump current I_pCa", 
       I_pCaMax=ScalarParam(0.05),
       K_mpCa=ScalarParam(5e-05),)

parameters("Ca background current I_bCa", 
       G_bCaMax=ScalarParam(0.0003842),)

parameters("SERCA2a Pump", 
       K_SR=ScalarParam(1.0),
       K_fb=ScalarParam(0.000168),
       K_rb=ScalarParam(3.29),
       N_fb=ScalarParam(1.2),
       N_rb=ScalarParam(1.0),
       v_maxf=ScalarParam(8.13e-05),
       v_maxr=ScalarParam(0.000318),)


component("Sarcolemmal Ca pump current I_pCa")
I_pCa = Ca_i*I_pCaMax/(Ca_i + K_mpCa)

component("Ca background current I_bCa")
I_bCa = G_bCaMax*(-E_Ca + V)

component("L-type Ca Channel")
alpha = 0.488561103264068*exp(0.1*V)
beta = 0.0428701959580221*exp(-0.0769230769230769*V)
gamma = 0.10375*Ca_ss
yCa_inf = 0.2 + 0.8/(12.1824939607035*exp(0.2*V) + 1.0)
tau_yCa = 20.0 + 600.0/(8.2092630577501*exp(0.105263157894737*V) + 1.0)
dyCa = (-yCa + yCa_inf)/tau_yCa
VFsqonRT = 1000.0*F*VFonRT
a1 = -0.341*Ca_o + 0.001*exp(2.0*VFonRT)
a2 = exp(2.0*VFonRT) - 1.0
ICamax = 4.0*PCa*VFsqonRT*a1/a2
I_Ca = ICamax*Open*yCa
PKprime = PK/(1.0 + Min(0.0, ICamax)/ICahalf)
a1 = K_i*expVFonRT - K_o
a2 = expVFonRT - 1.0
I_CaK = Open*PKprime*VFsqonRT*a1*yCa/a2

lcc[C0, C1] = 4.0*alpha
lcc[C1, C0] = beta
lcc[C1, C2] = 3.0*alpha
lcc[C2, C1] = 2.0*beta
lcc[C2, C3] = 2.0*alpha
lcc[C3, C2] = 3.0*beta
lcc[C3, C4] = alpha
lcc[C4, C3] = 4.0*beta
lcc[CCa0, CCa1] = 4.0*aL*alpha
lcc[CCa1, CCa0] = beta/bL
lcc[CCa1, CCa2] = 3.0*aL*alpha
lcc[CCa2, CCa1] = 2.0*beta/bL
lcc[CCa2, CCa3] = 2.0*aL*alpha
lcc[CCa3, CCa2] = 3.0*beta/bL
lcc[CCa3, CCa4] = aL*alpha
lcc[CCa4, CCa3] = 4.0*beta/bL
lcc[C0, CCa0] = gamma
lcc[CCa0, C0] = omega
lcc[C1, CCa1] = aL*gamma
lcc[CCa1, C1] = omega/bL
lcc[C2, CCa2] = aL**2.0*gamma
lcc[CCa2, C2] = omega/bL**2.0
lcc[C3, CCa3] = aL**3.0*gamma
lcc[CCa3, C3] = omega/bL**3.0
lcc[C4, CCa4] = aL**4.0*gamma
lcc[CCa4, C4] = omega/bL**4.0
lcc[C4, Open] = fL
lcc[Open, C4] = gL

component("RyR Channel")
a1 = (1000.0*Ca_ss)**mcoop
a2 = (1000.0*Ca_ss)**ncoop
dC1_RyR = -C1_RyR*a2*kaplus + O1_RyR*kaminus
dO2_RyR = O1_RyR*a1*kbplus - O2_RyR*kbminus
dC2_RyR = -C2_RyR*kcminus + O1_RyR*kcplus
dO1_RyR = -dC1_RyR - dC2_RyR - dO2_RyR
J_rel = v_1*(Ca_JSR - Ca_ss)*(O1_RyR + O2_RyR)

component("SERCA2a Pump")
f_b = (Ca_i/K_fb)**N_fb
r_b = (Ca_NSR/K_rb)**N_rb
J_up = K_SR*(f_b*v_maxf - r_b*v_maxr)/(f_b + r_b + 1.0)

component("Intracellular Ca")
J_tr = (-Ca_JSR + Ca_NSR)/tau_tr
J_xfer = (-Ca_i + Ca_ss)/tau_xfer
a1 = LTRPNCa*kltrpn_minus
dLTRPNCa = Ca_i*kltrpn_plus*(-LTRPNCa + 1.0) - a1
a1 = HTRPNCa*khtrpn_minus
dHTRPNCa = Ca_i*khtrpn_plus*(-HTRPNCa + 1.0) - a1
J_trpn = HTRPNtot*dHTRPNCa + LTRPNtot*dLTRPNCa
a1 = CMDNtot*KmCMDN*(Ca_ss + KmCMDN)**(-2.0)
beta_ss = 1.0/(a1 + 1.0)
a1 = CSQNtot*KmCSQN*(Ca_JSR + KmCSQN)**(-2.0)
beta_JSR = 1.0/(a1 + 1.0)
a1 = CMDNtot*KmCMDN*(Ca_i + KmCMDN)**(-2.0)
beta_i = 1.0/(a1 + 1.0)

dCa_i_dt = beta_i*(-A_cap*C_sc*(-2.0*I_NaCa + I_bCa + I_pCa)/(2000.0*F*V_myo) - J_trpn - J_up + J_xfer)
dCa_NSR_dt = -J_tr*V_JSR/V_NSR + J_up*V_myo/V_NSR
dCa_ss_dt = beta_ss*(-A_cap*C_sc*I_Ca/(2000.0*F*V_ss) + J_rel*V_JSR/V_ss - J_xfer*V_myo/V_ss)
dCa_JSR_dt = beta_JSR*(-J_rel + J_tr)
dLTRPNCa_dt = dLTRPNCa
dHTRPNCa_dt = dHTRPNCa
dC1_RyR_dt = dC1_RyR
dO1_RyR_dt = dO1_RyR
dO2_RyR_dt = dO2_RyR
dC2_RyR_dt = dC2_RyR
dyCa_dt = dyCa