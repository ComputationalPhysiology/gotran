# 
# 
# Abstract: The determinants of relaxation in cardiac muscle are poorly
# understood, yet compromised relaxation accompanies various pathologies and
# impaired pump function. In this study, we develop a model of active contraction
# to elucidate the relative importance of the [Ca2+]i transient magnitude, the
# unbinding of Ca2+ from troponin C (TnC), and the length-dependence of tension
# and Ca2+ sensitivity on relaxation. Using the framework proposed by one of our
# researchers, we extensively reviewed experimental literature, to quantitatively
# characterize the binding of Ca2+ to TnC, the kinetics of tropomyosin, the
# availability of binding sites, and the kinetics of crossbridge binding after
# perturbations in sarcomere length. Model parameters were determined from
# multiple experimental results and modalities (skinned and intact preparations)
# and model results were validated against data from length step, caged Ca2+,
# isometric twitches, and the half-time to relaxation with increasing sarcomere
# length experiments. A factorial analysis found that the [Ca2+]i transient and
# the unbinding of Ca2+ from TnC were the primary determinants of relaxation,
# with a fivefold greater effect than that of length-dependent maximum tension
# and twice the effect of tension-dependent binding of Ca2+ to TnC and
# length-dependent Ca2+ sensitivity. The affects of the [Ca2+]i transient and the
# unbinding rate of Ca2+ from TnC were tightly coupled with the effect of
# increasing either factor, depending on the reference [Ca2+]i transient and
# unbinding rate.
# 
# The original publication reference is cited below:
# 
# A Quantitative Analysis of Cardiac Myocyte Relaxation: A Simulation Study,
# Steven Niederer, Peter Hunter, Nicholas Smith, 2006Biophysical Journal, 90
# 1697-1722PubMed ID: 16339881
# 

# gotran file generated by cellml2gotran from niederer_hunter_smith_2006.cellml

parameters("Filament overlap",
           beta_0 = 4.9)

states("Tropomyosin",
       z = 0.014417937837)

parameters("Tropomyosin",
           alpha_0 = ScalarParam(8e-3, unit="ms**-1"),
           alpha_r1 = ScalarParam(2e-3, unit="ms**-1"),
           alpha_r2 = ScalarParam(1.75e-3, unit="ms**-1"),
           n_Rel = 3,
           K_z = 0.15,
           n_Hill = 3,
           Ca_50ref = ScalarParam(1.05e-3, unit="mmole*l**-1"),
           z_p = 0.85,
           beta_1 = -4)

parameters("Length independent tension",
           T_ref = ScalarParam(56.2, unit="N*mm**-2"))

states("Cross Bridges",
       Q_1 = 0,
       Q_2 = 0,
       Q_3 = 0)

parameters("Cross Bridges",
           a = 0.35,
           A_1 = -29,
           A_2 = 138,
           A_3 = 129,
           alpha_1 = ScalarParam(0.03, unit="ms**-1"),
           alpha_2 = ScalarParam(0.13, unit="ms**-1"),
           alpha_3 = ScalarParam(0.625, unit="ms**-1"))

parameters("Troponin",
           Ca_TRPN_Max = ScalarParam(70e-3, unit="mmole*l**-1"),
           k_on = ScalarParam(100, unit="mmole**-1*l*ms**-1"),
           k_Ref_off = ScalarParam(0.2, unit="ms**-1"),
           gamma_trpn = 2)

states("Intracellular ion concentrations",
       TRPN = ScalarParam(0.067593139865, unit="mmole*l**-1"))

component("Niederer 2006")
Ca_i = Conditional(Lt(time, 1), 1000*1.8433e-7, Conditional(And(Ge(time, 10), Lt(time, 15), ), 1000*(1.055*(time/1000)**3 - 0.03507*(time/1000)**2 + 0.0003992*time/1000 - 1.356e-6), Conditional(And(Ge(time, 15), Lt(time, 55), ), 1000*(0.014*(time/1000)**3 - 0.002555*(time/1000)**2 + 0.0001494*time/1000 - 1.428e-6), Conditional(And(Ge(time, 55), Lt(time, 250), ), 1000*(1.739e-5*(time/1000)**3 - 3.209e-6*(time/1000)**2 - 5.689e-6*time/1000 + 1.719e-6), Conditional(And(Ge(time, 250), Lt(time, 490), ), 1000*(0.0001321*(time/1000)**4 - 0.0002197*(time/1000)**3 + 0.0001374*(time/1000)**2 - 3.895e-5*time/1000 + 4.441e-6), 1000*1.2148e-7))))) # mmole*l**-1
Ca_b = Ca_TRPN_Max - TRPN # mmole*l**-1

component("Myofilaments")
ExtensionRatio = Conditional(Gt(time, 1000), 1, 1)
lambda_prev = ExtensionRatio
dExtensionRatiodt = 0 # ms**-1
lambda_ = Conditional(And(Gt(ExtensionRatio, 0.8), Le(ExtensionRatio, 1.15), ), ExtensionRatio, Conditional(Gt(ExtensionRatio, 1.15), 1.15, 0.8))

component("Filament overlap")
overlap = 1 + beta_0*(lambda_ - 1)

component("Tropomyosin")
K_2 = alpha_r2*z_p**n_Rel/(z_p**n_Rel + K_z**n_Rel)*(1 - n_Rel*K_z**n_Rel/(z_p**n_Rel + K_z**n_Rel)) # ms**-1
K_1 = alpha_r2*z_p**(n_Rel - 1)*n_Rel*K_z**n_Rel/(z_p**n_Rel + K_z**n_Rel)**2 # ms**-1
Ca_50 = Ca_50ref*(1 + beta_1*(lambda_ - 1)) # mmole*l**-1
Ca_TRPN_50 = Ca_50*Ca_TRPN_Max/(Ca_50 + k_Ref_off/k_on*(1 - (1 + beta_0*(lambda_ - 1))*0.5/gamma_trpn)) # mmole*l**-1
alpha_Tm = alpha_0*(Ca_b/Ca_TRPN_50)**n_Hill # ms**-1
beta_Tm = alpha_r1 + alpha_r2*z**(n_Rel - 1)/(z**n_Rel + K_z**n_Rel) # ms**-1
dz_dt = alpha_Tm*(1 - z) - beta_Tm*z
z_max = (alpha_0/(Ca_TRPN_50/Ca_TRPN_Max)**n_Hill - K_2)/(alpha_r1 + K_1 + alpha_0/(Ca_TRPN_50/Ca_TRPN_Max)**n_Hill)

component("Length independent tension")
T_Base = T_ref*z/z_max # N*mm**-2

component("Isometric tension")
T_0 = T_Base*overlap # N*mm**-2

component("Cross Bridges")
Q = Q_1 + Q_2 + Q_3
Tension = Conditional(Lt(Q, 0), T_0*(a*Q + 1)/(1 - Q), T_0*(1 + (a + 2)*Q)/(1 + Q)) # N*mm**-2
dQ_1_dt = A_1*dExtensionRatiodt - alpha_1*Q_1
dQ_2_dt = A_2*dExtensionRatiodt - alpha_2*Q_2
dQ_3_dt = A_3*dExtensionRatiodt - alpha_3*Q_3

component("Troponin")
k_off = Conditional(Gt(1 - Tension/(gamma_trpn*T_ref), 0.1), k_Ref_off*(1 - Tension/(gamma_trpn*T_ref)), k_Ref_off*0.1) # ms**-1
J_TRPN = (Ca_TRPN_Max - TRPN)*k_off - Ca_i*TRPN*k_on # mmole*l**-1*ms**-1

component("Intracellular ion concentrations")
dTRPN_dt = J_TRPN

